# 📱 应用弹窗功能使用指南

## 🎯 功能概述

应用弹窗是一个强大的用户引导和营销工具，可以在用户打开应用时自动显示弹窗。

### 主要特性

✅ **后台自由开关** - 随时启用/禁用弹窗  
✅ **背景图片** - 100% 透明度完全覆盖背景  
✅ **分页显示** - 支持多个弹窗，用户可左右切换  
✅ **主题适配** - 自动适配深色/浅色主题  
✅ **按钮跳转** - 支持旺旺协议（wangwang://）和网址  
✅ **复制功能** - 点击按钮自动复制文字  
✅ **超级管理员专属** - 仅超级管理员可编辑

---

## 🔐 权限要求

**仅超级管理员可见和编辑**

普通用户：可以看到弹窗  
普通管理员：**无权访问**  
租户管理员：**无权访问**  
超级管理员：**完全管理权限**

---

## 📖 快速开始

### 步骤1: 访问管理页面

1. 以超级管理员身份登录
2. 点击左侧菜单 **"网站设置"**
3. 点击 **"应用弹窗"**

或直接访问：`https://你的域名/admin/popups`

---

### 步骤2: 创建第一个弹窗

点击右上角 **"创建弹窗"** 按钮

填写以下信息：

#### 📝 基础信息

**标题** (可选)
```
示例: 欢迎使用我们的应用！
```

**内容** (可选，支持换行)
```
示例:
我们是专业的在线服务平台
有任何问题请联系客服
每天都有新的优惠活动
```

---

#### 🖼️ 背景图片 (可选)

**上传方式**:
1. 点击 **"选择文件"** 上传图片
2. 或粘贴图片 URL

**建议尺寸**: 600x800 像素（竖屏）

**透明度**: 固定 100%（完全显示）

**提示**: 如果设置了背景图片，标题和内容会自动添加阴影，提高可读性

---

#### 🔘 按钮设置

**按钮文字** (可选)
```
示例: 旺旺客服：dahai888
用途: 用户点击后会自动复制此文字
```

**跳转链接** (可选)
```
示例:
- 旺旺协议: wangwang://
- 网址: https://example.com
- 其他: tel:10086
```

**功能说明**:
1. 用户点击按钮
2. 自动复制 "按钮文字" 到剪贴板
3. 显示 "已复制" 提示
4. 自动跳转到 "跳转链接"

---

#### ⚙️ 高级设置

**显示顺序**
```
数字越小越靠前
示例: 0, 1, 2, 3...
```

**启用弹窗**
```
开启: 用户会看到此弹窗
关闭: 弹窗不显示（但保留在列表中）
```

---

### 步骤3: 保存并测试

1. 点击 **"保存"** 按钮
2. 打开新标签页或刷新应用
3. 应该看到弹窗自动显示

---

## 📚 使用场景

### 场景1: 旺旺客服引导 ⭐

**目标**: 引导用户添加旺旺客服

**配置**:
```
标题: 联系客服
内容: 有任何问题？立即联系我们的在线客服！
按钮文字: 旺旺客服：dahai888
按钮链接: wangwang://
显示顺序: 0
启用: ✅
```

**用户体验**:
1. 打开应用，看到弹窗
2. 点击按钮
3. 复制 "旺旺客服：dahai888"
4. 跳转到旺旺 App（自动粘贴）

---

### 场景2: 活动推广海报

**目标**: 推广限时活动

**配置**:
```
标题: （可不填，海报自带标题）
内容: （可不填，海报自带内容）
背景图片: 上传活动海报（600x800）
按钮文字: 新用户注册码：ABC123
按钮链接: https://你的网站/register
显示顺序: 0
启用: ✅
```

**用户体验**:
1. 看到精美的活动海报
2. 点击按钮复制注册码
3. 跳转到注册页面

---

### 场景3: 多页新手引导

**目标**: 分步骤介绍应用功能

**配置弹窗1**:
```
标题: 欢迎使用
内容: 这是一个功能强大的平台...
按钮文字: 了解更多
按钮链接: （可不填）
显示顺序: 0
启用: ✅
```

**配置弹窗2**:
```
标题: 如何开始
内容: 1. 完善个人资料
       2. 浏览游戏中心
       3. 参与社交互动
显示顺序: 1
启用: ✅
```

**配置弹窗3**:
```
标题: 联系我们
内容: 客服微信：xxx
      客服QQ：xxx
按钮文字: 旺旺客服：dahai888
按钮链接: wangwang://
显示顺序: 2
启用: ✅
```

**用户体验**:
1. 看到第一个弹窗（欢迎）
2. 点击 "下一页" 查看第二个（引导）
3. 再点击 "下一页" 查看第三个（联系方式）
4. 可以随时点击 "上一页" 返回

---

## 🎨 设计建议

### 文字清晰度

**无背景图片时**:
- 文字会自动适配主题颜色
- 深色主题：白色文字
- 浅色主题：深色文字

**有背景图片时**:
- 文字会自动添加阴影
- 建议使用高对比度背景
- 避免文字区域过于花哨

---

### 背景图片

**推荐尺寸**: 600x800 像素（竖屏）

**文件格式**: JPG, PNG, WebP

**文件大小**: < 500KB（压缩后）

**设计要点**:
1. 重要信息放在中央
2. 避免边缘过于复杂
3. 预留按钮位置（底部中央）
4. 确保文字可读

**在线工具**:
- [Canva](https://canva.com) - 设计海报
- [TinyPNG](https://tinypng.com) - 压缩图片
- [Remove.bg](https://remove.bg) - 移除背景

---

### 按钮文字

**好的示例**:
```
✅ 旺旺客服：dahai888
✅ 客服微信：ABC123
✅ 注册码：WELCOME2024
✅ 联系方式：10086
```

**避免**:
```
❌ 点击这里（太模糊）
❌ 了解更多（没有具体信息）
❌ （留空，用户不知道要复制什么）
```

---

## 🔧 高级功能

### 多个弹窗排序

**方法1: 编辑时设置顺序**
```
弹窗A: order = 0（第一个显示）
弹窗B: order = 1（第二个显示）
弹窗C: order = 2（第三个显示）
```

**方法2: 使用上移/下移按钮**
1. 在弹窗列表中找到要调整的弹窗
2. 点击 ⬆️ 上移 或 ⬇️ 下移
3. 自动保存新顺序

---

### 临时禁用弹窗

**场景**: 活动已结束，但想保留配置

**操作**:
1. 点击编辑按钮
2. 关闭 "启用弹窗" 开关
3. 保存

**效果**: 弹窗不再显示，但配置保留，随时可以重新启用

---

### 测试弹窗

**开发环境**:
1. 打开浏览器控制台（F12）
2. 访问应用
3. 查看网络请求：`/api/popups`
4. 查看返回的弹窗数据

**生产环境**:
1. 使用隐身窗口
2. 清除浏览器缓存
3. 刷新页面测试

---

## 🐛 常见问题

### Q1: 创建了弹窗但没有显示？

**检查清单**:
- [ ] 弹窗是否启用？（开关打开）
- [ ] 是否有启用的弹窗？（至少一个）
- [ ] 浏览器缓存是否清除？
- [ ] 网络请求是否成功？（F12 → Network → `/api/popups`）

**解决方法**:
```
1. 检查弹窗启用状态
2. 清除浏览器缓存（Ctrl/Cmd + Shift + R）
3. 检查浏览器控制台是否有错误
```

---

### Q2: 旺旺协议不工作？

**可能原因**:
1. 未安装旺旺 App
2. 浏览器阻止了协议跳转
3. 协议格式错误

**解决方法**:
```
iOS/Android:
- 确保已安装旺旺 App
- 允许浏览器打开外部应用

电脑端:
- 安装阿里旺旺客户端
- 允许浏览器调用外部程序
```

**测试链接**:
```
wangwang://
```

---

### Q3: 复制功能不工作？

**可能原因**:
1. 浏览器不支持 Clipboard API
2. HTTPS 环境问题
3. 权限被拒绝

**解决方法**:
```
1. 使用现代浏览器（Chrome, Edge, Safari）
2. 确保使用 HTTPS（不是 HTTP）
3. 允许浏览器访问剪贴板
```

---

### Q4: 背景图片不显示？

**检查清单**:
- [ ] 图片 URL 是否正确？
- [ ] 图片是否可公开访问？
- [ ] 图片格式是否支持？（JPG, PNG, WebP）

**解决方法**:
```
1. 在新标签页打开图片 URL，确认可访问
2. 使用上传功能（而不是直接粘贴 URL）
3. 检查图片大小（建议 < 500KB）
```

---

### Q5: 如何删除所有弹窗？

**方法1**: 逐个删除
```
1. 点击弹窗的删除按钮（🗑️）
2. 确认删除
```

**方法2**: 全部禁用
```
1. 编辑每个弹窗
2. 关闭 "启用弹窗" 开关
3. 保存
```

---

## 📊 数据库说明

弹窗数据存储在 Turso 数据库的 `app_popups` 表中：

```sql
CREATE TABLE app_popups (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  tenant_id INTEGER DEFAULT 0,
  enabled INTEGER DEFAULT 0,
  title TEXT,
  content TEXT,
  background_image TEXT,
  button_text TEXT,
  button_url TEXT,
  order INTEGER DEFAULT 0,
  created_at TEXT,
  updated_at TEXT
);
```

---

## 🔐 安全注意事项

### 权限控制

✅ **已实现**:
- 后端 API 检查超级管理员权限
- 前端路由需要管理员认证
- 普通用户无法访问管理页面

❌ **不要做**:
- 不要在弹窗中放置敏感信息
- 不要使用未知来源的图片 URL
- 不要在按钮链接中包含密码

---

### 内容审核

建议创建弹窗前：
- [ ] 确认文字内容无误
- [ ] 检查图片合法合规
- [ ] 测试链接是否正确
- [ ] 预览效果是否理想

---

## 📈 未来功能建议

### 计划中
- [ ] **显示频率控制** - 每天只显示一次
- [ ] **用户关闭记录** - 用户关闭后不再显示
- [ ] **A/B 测试** - 随机显示不同版本
- [ ] **点击统计** - 统计用户点击率

### 可扩展
- [ ] **视频背景** - 支持视频作为背景
- [ ] **富文本编辑** - 支持格式化文字
- [ ] **动态内容** - 根据用户属性显示不同内容
- [ ] **定时发布** - 设置弹窗生效时间

---

## 🎓 最佳实践

### 内容策略

**DO ✅**:
1. 保持文字简洁（< 100 字）
2. 突出核心信息
3. 使用清晰的行动号召
4. 定期更新内容

**DON'T ❌**:
1. 不要一次显示太多弹窗（建议 ≤ 3 个）
2. 不要频繁更改弹窗内容
3. 不要使用低质量图片
4. 不要忽略移动端体验

---

### 设计规范

**颜色**:
- 背景图片：高对比度
- 按钮：使用主题色（自动适配）
- 文字：确保可读性

**布局**:
- 标题：< 20 字
- 内容：< 100 字
- 按钮：< 30 字

**图片**:
- 格式：WebP > PNG > JPG
- 尺寸：600x800（竖屏）
- 大小：< 500KB

---

## 📞 技术支持

如有问题，请：
1. 查看本文档
2. 检查浏览器控制台错误
3. 联系技术团队

---

**版本**: v1.26.0  
**最后更新**: 2024  
**状态**: ✅ 已上线

